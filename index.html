<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ò–≥—Ä–∞: –ü–æ–¥–±–µ—Ä–∏ –ñ–∏–≤–æ—Ç–Ω–æ–µ (–î–ª—è –ú–∞–ª—ã—à–µ–π)</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* –û–±—â–∏–µ —Å—Ç–∏–ª–∏ */
        body {
            font-family: 'Comic Sans MS', 'Inter', sans-serif; 
            background-color: #f7f7f7; 
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            user-select: none; 
        }

        .game-container {
            width: 100%;
            max-width: 900px; /* –£–≤–µ–ª–∏—á–∏–ª –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É—é —à–∏—Ä–∏–Ω—É –¥–ª—è –∞–ª—å–±–æ–º–Ω–æ–π –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏–∏ */
            background-color: #ffffff;
            padding: 32px 25px 40px 25px; 
            border-radius: 35px; 
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15); 
            text-align: center;
            border: 4px solid #a78bfa; 
        }

        h1 {
            color: #6d28d9; 
            font-size: clamp(2rem, 8vw, 3.5rem); /* –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π —Ä–∞–∑–º–µ—Ä –∑–∞–≥–æ–ª–æ–≤–∫–∞ */
            font-weight: 900; 
            margin-bottom: 12px;
            text-shadow: 2px 2px 0px rgba(0,0,0,0.1);
        }

        p {
            color: #4b5563; 
            font-size: clamp(1rem, 4vw, 1.5rem); /* –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π —Ä–∞–∑–º–µ—Ä —Ç–µ–∫—Å—Ç–∞ */
            margin-bottom: 28px;
            font-weight: 600;
        }

        /* –°—Ç–∏–ª—å –¥–ª—è –∑–æ–Ω—ã —Å–∏–ª—É—ç—Ç–∞ */
        .drop-zone {
            width: 100%;
            height: clamp(200px, 40vw, 300px); /* –ê–¥–∞–ø—Ç–∏–≤–Ω–∞—è –≤—ã—Å–æ—Ç–∞ */
            background-color: #e0f2fe; 
            border-radius: 25px; 
            border: 6px dashed #7dd3fc; 
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            margin-bottom: 30px;
            transition: background-color 0.3s ease-in-out;
            position: relative;
            overflow: hidden; 
        }
        .drop-zone.bg-green-100 {
            background-color: #d1fae5; 
            border-color: #34d399; 
        }

        /* –°–∏–ª—É—ç—Ç-—Ç–µ–Ω—å */
        #silhouette-icon {
            filter: grayscale(100%) brightness(0.2); 
            transition: opacity 0.3s ease-in-out;
            font-size: clamp(6rem, 20vw, 10rem); /* –û–≥—Ä–æ–º–Ω—ã–π, –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–π —Ä–∞–∑–º–µ—Ä */
            line-height: 1; 
        }

        /* --- –°—Ç–∏–ª–∏ –¥–ª—è –ö–ê–†–ê–£–°–ï–õ–ò (–†—É—á–Ω–æ–π —Å–≤–∞–π–ø) --- */
        #choices-wrapper {
            overflow-x: scroll; 
            -webkit-overflow-scrolling: touch; 
            padding: 15px 0; 
            scrollbar-width: none; 
            -ms-overflow-style: none; 
        }
        #choices-wrapper::-webkit-scrollbar {
            display: none; 
        }
        
        #carousel-track {
            display: flex;
            justify-content: start; 
            width: fit-content; 
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–∞—Ä—Ç–æ—á–µ–∫ (—ç–º–æ–¥–∑–∏) - –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –Ω–∞ –±–æ–ª—å—à–æ–π touch target */
        .choice-card {
            cursor: grab;
            touch-action: none; 
            transition: transform 0.2s ease-out, box-shadow 0.2s ease-out;
            position: relative;
            user-select: none;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 20px 10px; 
            background: linear-gradient(145deg, #f0f9ff, #e0f2fe); 
            border-radius: 20px; 
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.15); 
            height: 140px; 
            width: 120px; /* –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —à–∏—Ä–∏–Ω–∞ –¥–ª—è –±–æ–ª—å—à–æ–≥–æ —Ç–∞—á-—Ç–∞—Ä–≥–µ—Ç–∞ */
            flex-shrink: 0; 
            margin-right: 15px; 
            border: 2px solid #93c5fd; 
        }
        .choice-card:active {
            transform: scale(0.98); 
        }

        /* –°—Ç–∏–ª—å –¥–ª—è –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–µ–º–æ–π –∫–∞—Ä—Ç–æ—á–∫–∏ */
        .dragging {
            position: absolute;
            z-index: 9999; 
            transform: scale(1.3) rotate(5deg); 
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3); 
            opacity: 0.98;
            background: linear-gradient(145deg, #fefce8, #fffbeb); 
        }
        
        .choice-card span:first-child { /* –≠–º–æ–¥–∑–∏ */
            font-size: 5rem; /* –ß—É—Ç—å –º–µ–Ω—å—à–µ, —á–µ–º 6.5rem, –Ω–æ –≤—Å–µ –µ—â–µ –æ–≥—Ä–æ–º–Ω—ã–π */
            line-height: 1;
        }
        .choice-card span:last-child { /* –ù–∞–∑–≤–∞–Ω–∏–µ */
            font-size: 1rem; 
            font-weight: 700;
            color: #374151; 
        }

        .correct-match-card {
            z-index: 9; 
            background: linear-gradient(145deg, #d1fae5, #a7f3d0); 
            border-color: #10b981;
        }
        .correct-match-card span:last-child {
            font-size: 1.8rem; 
            color: #166534;
        }

        /* –ê–Ω–∏–º–∞—Ü–∏—è –∫–æ–Ω—Ñ–µ—Ç—Ç–∏ –∏ —Å–æ–æ–±—â–µ–Ω–∏—è */
        .confetti {
            position: absolute;
            width: 12px; 
            height: 12px;
            background: radial-gradient(circle, #fcd34d, #ef4444);
            border-radius: 50%;
            opacity: 0;
            animation: confetti-fall 1.8s ease-out forwards; 
            z-index: 100; 
        }

        @keyframes confetti-fall {
            0% { transform: translateY(0) rotate(0deg); opacity: 1; }
            100% { transform: translateY(500px) rotate(720deg); opacity: 0; }
        }

        .message-box {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            padding: 20px 40px; 
            border-radius: 20px; 
            font-size: 2rem; 
            font-weight: bold;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.25);
            transition: opacity 0.3s ease-in-out;
            z-index: 100; 
        }
        .success { background-color: #34d399; color: white; }
        .hint { background-color: #fcd34d; color: #78350f; }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –ø–æ–ª–∑—É–Ω–∫–∞ (—Å–ª–∞–π–¥–µ—Ä–∞) - –û–ß–ï–ù–¨ –ë–û–õ–¨–®–û–ô –ò –£–î–û–ë–ù–´–ô –î–õ–Ø –î–ï–¢–ï–ô */
        #carousel-slider {
            -webkit-appearance: none;
            appearance: none;
            width: 100%;
            height: 25px; 
            background: #d1e5fa; 
            border-radius: 12px; 
            margin-top: 25px; 
            outline: none; 
            box-shadow: inset 0 2px 5px rgba(0,0,0,0.1);
        }

        #carousel-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 50px; 
            height: 50px; 
            background: #8b5cf6; 
            border-radius: 50%;
            cursor: grab;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3); 
            transition: background-color 0.2s, transform 0.1s;
            border: 4px solid #ede9fe; 
        }
        #carousel-slider::-webkit-slider-thumb:active {
            transform: scale(0.95); 
            cursor: grabbing;
        }

        #carousel-slider::-moz-range-thumb {
            width: 50px; 
            height: 50px;
            background: #8b5cf6;
            border-radius: 50%;
            cursor: grab;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            transition: background-color 0.2s, transform 0.1s;
            border: 4px solid #ede9fe;
        }
        #carousel-slider::-moz-range-thumb:active {
             transform: scale(0.95); 
             cursor: grabbing;
        }

    </style>
</head>
<body>

<div class="game-container">
    <h1>–£–ì–ê–î–ê–ô –ñ–ò–í–û–¢–ù–û–ï!</h1>
    <p>–°–º–æ–∂–µ—à—å –Ω–∞–π—Ç–∏ –∏ –ø–µ—Ä–µ—Ç–∞—â–∏—Ç—å? ü•∞</p>

    
    <div id="drop-zone" class="drop-zone relative">
        <div id="silhouette-icon"></div> 
        <div id="status-message" class="message-box hidden"></div>
    </div>

    <!-- –ö–∞—Ä—É—Å–µ–ª—å -->
    <div id="choices-wrapper">
        <!-- #carousel-track –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω —á–µ—Ä–µ–∑ JS -->
    </div>

    <!-- –ü–æ–ª–∑—É–Ω–æ–∫ -->
    <div class="mt-4 px-4">
        <input type="range" id="carousel-slider" min="0" value="0" class="w-full">
    </div>
</div>

<script>
    // ------------------------------------
    // 1. –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø –ò–ì–†–´
    // ------------------------------------

    const animals = [
        { id: 'dog', name: '–°–æ–±–∞—á–∫–∞', emoji: 'üê∂' }, 
        { id: 'cat', name: '–ö–æ—à–µ—á–∫–∞', emoji: 'üê±' },
        { id: 'pig', name: '–°–≤–∏–Ω–∫–∞', emoji: 'üê∑' },
        { id: 'cow', name: '–ö–æ—Ä–æ–≤–∫–∞', emoji: 'üêÆ' },
        { id: 'lion', name: '–õ—ë–≤–∞', emoji: 'ü¶Å' },
        { id: 'duck', name: '–£—Ç–æ—á–∫–∞', emoji: 'ü¶Ü' },
        { id: 'bear', name: '–ú–∏—à–∫–∞', emoji: 'üêª' },
        { id: 'fox', name: '–õ–∏—Å–∏—á–∫–∞', emoji: 'ü¶ä' },
        { id: 'rabbit', name: '–ó–∞–π—á–∏–∫', emoji: 'üê∞' },
        { id: 'monkey', name: '–û–±–µ–∑—å—è–Ω–∫–∞', emoji: 'üêí' },
        { id: 'zebra', name: '–ó–µ–±—Ä–∞', emoji: 'ü¶ì' },
        { id: 'horse', name: '–õ–æ—à–∞–¥–∫–∞', emoji: 'üê¥' },
        { id: 'tiger', name: '–¢–∏–≥—Ä—ë–Ω–æ–∫', emoji: 'üêØ' },
    ];

    let currentQuestion = {};
    let isCorrectlyAnswered = false;

    // –°—Å—ã–ª–∫–∏ –Ω–∞ —ç–ª–µ–º–µ–Ω—Ç—ã DOM
    const dropZoneEl = document.getElementById('drop-zone');
    const silhouetteIconEl = document.getElementById('silhouette-icon');
    const choicesWrapperEl = document.getElementById('choices-wrapper'); 
    const statusMessageEl = document.getElementById('status-message');
    const carouselSliderEl = document.getElementById('carousel-slider'); 
    
    let carouselTrackEl = null; 

    // ------------------------------------
    // 2. –õ–û–ì–ò–ö–ê –ò–ì–†–´ –ò D&D
    // ------------------------------------

    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
        return array;
    }

    function createNewQuestion() {
        const correctAnswer = animals[Math.floor(Math.random() * animals.length)];
        
        // 8 –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –≤—ã–±–æ—Ä–∞: 1 –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –∏ 7 –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö
        const incorrectAnswers = shuffleArray(animals.filter(a => a.id !== correctAnswer.id)).slice(0, 7);
        const choices = shuffleArray([correctAnswer, ...incorrectAnswers]);

        currentQuestion = {
            correct: correctAnswer,
            choices: choices 
        };
    }

    // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∫–∞—Ä—Ç–æ—á–µ–∫ –∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Å–ª—É—à–∞—Ç–µ–ª–µ–π D&D
    function renderChoices(choices) {
        choices.forEach(animal => {
            const card = document.createElement('div');
            card.className = 'choice-card';
            card.id = `card-${animal.id}-${Date.now() + Math.random()}`; 
            card.setAttribute('data-id', animal.id);
            // pointer-events-none –¥–ª—è span, —á—Ç–æ–±—ã –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–ª–æ –Ω–∞ div
            card.innerHTML = `<span class="pointer-events-none">${animal.emoji}</span>
                              <span class="mt-1 pointer-events-none">${animal.name}</span>`;
            
            carouselTrackEl.appendChild(card);
            addDragListeners(card);
        });
    }
    
    // --- –§–£–ù–ö–¶–ò–ò –°–õ–ê–ô–î–ï–†–ê/–°–í–ê–ô–ü–ê ---
    function updateSliderConfig() {
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ –∫–∞—Ä—É—Å–µ–ª—å, –ø—Ä–µ–∂–¥–µ —á–µ–º —Ä–∞–±–æ—Ç–∞—Ç—å —Å –Ω–µ–π
        if (!carouselTrackEl) return;
        
        // –í—ã—á–∏—Å–ª—è–µ–º –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –¥–ª—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∏
        const maxScroll = carouselTrackEl.scrollWidth - choicesWrapperEl.clientWidth;
        
        if (maxScroll <= 0) {
            // –ï—Å–ª–∏ –∫–æ–Ω—Ç–µ–Ω—Ç –Ω–µ –ø—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ—Ç—Å—è, —Å–∫—Ä—ã–≤–∞–µ–º –ø–æ–ª–∑—É–Ω–æ–∫
            carouselSliderEl.style.display = 'none';
            carouselSliderEl.max = 0;
            carouselSliderEl.value = 0;
            choicesWrapperEl.scrollLeft = 0; 
        } else {
            // –ò–Ω–∞—á–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∏ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –ø–æ–ª–∑—É–Ω–æ–∫
            carouselSliderEl.style.display = 'block';
            carouselSliderEl.max = maxScroll;
            // –û–±–Ω–æ–≤–ª—è–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ–ª–∑—É–Ω–∫–∞ –¥–æ —Ç–µ–∫—É—â–µ–π –ø—Ä–æ–∫—Ä—É—Ç–∫–∏
            carouselSliderEl.value = choicesWrapperEl.scrollLeft; 
        }
    }

    // –°–ª—É—à–∞—Ç–µ–ª—å: –î–≤–∏–∂–µ–Ω–∏–µ –ø–æ–ª–∑—É–Ω–∫–∞ -> –ü—Ä–æ–∫—Ä—É—Ç–∫–∞ –∫–∞—Ä—É—Å–µ–ª–∏
    carouselSliderEl.addEventListener('input', () => {
        choicesWrapperEl.scrollLeft = carouselSliderEl.value;
    });

    // –°–ª—É—à–∞—Ç–µ–ª—å: –ü—Ä–æ–∫—Ä—É—Ç–∫–∞ –∫–∞—Ä—É—Å–µ–ª–∏ (—Å–≤–∞–π–ø/–º—ã—à—å) -> –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–ª–∑—É–Ω–∫–∞
    choicesWrapperEl.addEventListener('scroll', () => {
        carouselSliderEl.value = choicesWrapperEl.scrollLeft;
    });
    
    // –°–ª—É—à–∞—Ç–µ–ª—å –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–æ–≤–æ—Ä–æ—Ç–∞ —ç–∫—Ä–∞–Ω–∞/–∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞ –æ–∫–Ω–∞
    window.addEventListener('resize', updateSliderConfig);
    // --- –ö–û–ù–ï–¶ –§–£–ù–ö–¶–ò–ô –°–õ–ê–ô–î–ï–†–ê/–°–í–ê–ô–ü–ê ---

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è/–∑–∞–ø—É—Å–∫ –Ω–æ–≤–æ–≥–æ —Ä–∞—É–Ω–¥–∞
    function startNewRound() {
        isCorrectlyAnswered = false;
        dropZoneEl.classList.remove('bg-green-100');
        statusMessageEl.classList.add('hidden');
        
        // --- –û—á–∏—Å—Ç–∫–∞ –∏ —Å–æ–∑–¥–∞–Ω–∏–µ –∫–∞—Ä—É—Å–µ–ª–∏ ---
        choicesWrapperEl.innerHTML = '';
        Array.from(dropZoneEl.children).forEach(child => {
            if (child.classList.contains('correct-match-card')) {
                child.remove(); 
            }
        });
        
        carouselTrackEl = document.createElement('div');
        carouselTrackEl.id = 'carousel-track';
        choicesWrapperEl.appendChild(carouselTrackEl);
        // --- –ö–û–ù–ï–¶ –û–ß–ò–°–¢–ö–ò ---

        createNewQuestion();

        // 1. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–∏–ª—É—ç—Ç
        silhouetteIconEl.textContent = currentQuestion.correct.emoji;
        silhouetteIconEl.style.opacity = '0.7'; 
        
        // 2. –°–æ–∑–¥–∞–µ–º –∫–∞—Ä—Ç–æ—á–∫–∏ –≤—ã–±–æ—Ä–∞ (8 —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤)
        renderChoices(currentQuestion.choices);
        
        // 3. –û–±–Ω–æ–≤–ª—è–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –ø–æ–ª–∑—É–Ω–∫–∞
        // –ò—Å–ø–æ–ª—å–∑—É–µ–º –Ω–µ–±–æ–ª—å—à—É—é –∑–∞–¥–µ—Ä–∂–∫—É, —á—Ç–æ–±—ã –±—Ä–∞—É–∑–µ—Ä —É—Å–ø–µ–ª –æ—Ç—Ä–∏—Å–æ–≤–∞—Ç—å track width
        setTimeout(updateSliderConfig, 100); 
    }

    // --- D&D –§–£–ù–ö–¶–ò–ò ---
    let activeItem = null;
    let currentX;
    let currentY;
    let xOffset = 0;
    let yOffset = 0;

    function addDragListeners(item) {
        item.addEventListener("touchstart", dragStart, false);
        item.addEventListener("touchend", dragEnd, false);
        item.addEventListener("touchmove", drag, false);
        item.addEventListener("mousedown", dragStart, false);
        item.addEventListener("mouseup", dragEnd, false);
        item.addEventListener("mousemove", drag, false);
    }

    function getCoordinates(e) {
        if (e.type.includes("touch")) {
            // –£–±–µ–∂–¥–∞–µ–º—Å—è, —á—Ç–æ touch-—Å–æ–±—ã—Ç–∏–µ –∏–º–µ–µ—Ç touches
            if (e.touches && e.touches.length > 0) {
                 return { clientX: e.touches[0].clientX, clientY: e.touches[0].clientY };
            }
            // –î–ª—è touchend, touches –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º, –∏—Å–ø–æ–ª—å–∑—É–µ–º changedTouches
            if (e.changedTouches && e.changedTouches.length > 0) {
                 return { clientX: e.changedTouches[0].clientX, clientY: e.changedTouches[0].clientY };
            }
            return { clientX: null, clientY: null }; // Fallback
        }
        return { clientX: e.clientX, clientY: e.clientY };
    }
    
    function dragStart(e) {
        if (isCorrectlyAnswered) return;
        const coords = getCoordinates(e);
        if (!coords.clientX) return; // –ó–∞—â–∏—Ç–∞ –æ—Ç –ø—É—Å—Ç–æ–≥–æ touch-—Å–æ–±—ã—Ç–∏—è

        activeItem = e.target.closest('.choice-card');
        if (activeItem) {
            e.preventDefault(); 
            
            // –ï—Å–ª–∏ –∫–∞—Ä—Ç–æ—á–∫–∞ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–µ—Ç—Å—è, –µ–µ —Å–≤–∞–π–ø-—Ä–æ–¥–∏—Ç–µ–ª—å –Ω–µ –¥–æ–ª–∂–µ–Ω –ø—Ä–æ–∫—Ä—É—á–∏–≤–∞—Ç—å—Å—è
            choicesWrapperEl.style.overflowX = 'hidden'; 
            
            const rect = activeItem.getBoundingClientRect();
            xOffset = coords.clientX - rect.left;
            yOffset = coords.clientY - rect.top;
            
            activeItem.classList.add('dragging');
            activeItem.style.position = 'absolute';
            // –ü–µ—Ä–µ–º–µ—â–∞–µ–º –∫–∞—Ä—Ç–æ—á–∫—É –≤ body, —á—Ç–æ–±—ã –æ–Ω–∞ –Ω–µ –æ–±—Ä–µ–∑–∞–ª–∞—Å—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–º
            document.body.appendChild(activeItem); 
            
            currentX = coords.clientX - xOffset;
            currentY = coords.clientY - yOffset;
        }
    }

    function dragEnd(e) {
        if (!activeItem || isCorrectlyAnswered) return;
        
        // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Å–≤–∞–π–ø–∞/–ø—Ä–æ–∫—Ä—É—Ç–∫–∏
        choicesWrapperEl.style.overflowX = 'scroll'; 

        const dropZoneRect = dropZoneEl.getBoundingClientRect();
        const droppedId = activeItem.getAttribute('data-id');

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ø–∞–¥–∞–Ω–∏—è –≤ –∑–æ–Ω—É —Å–±—Ä–æ—Å–∞ (Drop Zone)
        const isDroppedOver = 
            currentX + (activeItem.offsetWidth / 2) > dropZoneRect.left &&
            currentX + (activeItem.offsetWidth / 2) < dropZoneRect.right &&
            currentY + (activeItem.offsetHeight / 2) > dropZoneRect.top &&
            currentY + (activeItem.offsetHeight / 2) < dropZoneRect.bottom;

        if (isDroppedOver) {
            checkMatch(droppedId, activeItem);
        } else {
            resetCardPosition(activeItem);
        }
        activeItem = null;
        xOffset = 0;
        yOffset = 0;
    }

    function drag(e) {
        if (!activeItem || isCorrectlyAnswered) return;
        e.preventDefault(); 
        const coords = getCoordinates(e);
        if (!coords.clientX) return; // –ó–∞—â–∏—Ç–∞ –æ—Ç –ø—É—Å—Ç–æ–≥–æ touch-—Å–æ–±—ã—Ç–∏—è

        currentX = coords.clientX - xOffset;
        currentY = coords.clientY - yOffset;
        activeItem.style.left = `${currentX}px`;
        activeItem.style.top = `${currentY}px`;
    }
    
    function resetCardPosition(card) {
        // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∫–∞—Ä—Ç–æ—á–∫—É –æ–±—Ä–∞—Ç–Ω–æ –≤ –∫–∞—Ä—É—Å–µ–ª—å
        carouselTrackEl.appendChild(card); 
        card.classList.remove('dragging');
        card.style.position = 'relative'; 
        card.style.left = 'auto';
        card.style.top = 'auto';
        card.style.transform = 'none'; 
        showStatus('–ü–æ–ø—Ä–æ–±—É–π –µ—â—ë! ‚ú®', 'hint', 1000); 
    }
    
    function checkMatch(droppedId, cardElement) {
        if (droppedId === currentQuestion.correct.id) {
            isCorrectlyAnswered = true;
            
            choicesWrapperEl.style.overflowX = 'hidden'; 

            startConfetti();
            dropZoneEl.classList.add('bg-green-100');
            showStatus(`ü•≥ –£—Ä–∞! –≠—Ç–æ ${currentQuestion.correct.name}!`, 'success', 2500); 

            cardElement.style.position = 'absolute';
            cardElement.style.top = '50%';
            cardElement.style.left = '50%';
            cardElement.style.transform = 'translate(-50%, -50%) scale(1.1)'; 
            cardElement.classList.remove('dragging');
            cardElement.classList.add('correct-match-card'); 
            
            const nameSpan = cardElement.querySelector('span:nth-child(2)');
            if (nameSpan) {
                nameSpan.style.display = 'block'; 
                nameSpan.classList.add('text-xl', 'text-gray-800', 'font-bold');
                nameSpan.classList.remove('text-xs', 'font-semibold', 'text-gray-600');
            }
            
            dropZoneEl.appendChild(cardElement);
            
            choicesWrapperEl.innerHTML = '';
            silhouetteIconEl.style.opacity = '0';
            
            // –ó–∞–ø—É—Å–∫–∞–µ–º –Ω–æ–≤—ã–π —Ä–∞—É–Ω–¥
            setTimeout(() => {
                startNewRound();
            }, 2500); 

        } else {
            resetCardPosition(cardElement);
        }
    }

    function showStatus(message, type, duration) {
        statusMessageEl.textContent = message;
        statusMessageEl.className = 'message-box';
        statusMessageEl.classList.add(type);
        statusMessageEl.classList.remove('hidden');

        setTimeout(() => {
            statusMessageEl.classList.add('hidden');
        }, duration);
    }

    window.onload = startNewRound;
    
    function startConfetti() {
        const count = 40; 
        const dropZoneRect = dropZoneEl.getBoundingClientRect();
        
        for (let i = 0; i < count; i++) {
            const confetti = document.createElement('div');
            confetti.className = 'confetti';
            confetti.style.left = `${Math.random() * dropZoneRect.width}px`;
            confetti.style.top = `${dropZoneRect.height / 2}px`;
            confetti.style.animationDelay = `${Math.random() * 0.7}s`; 
            
            dropZoneEl.appendChild(confetti);
            
            setTimeout(() => confetti.remove(), 2500); 
        }
    }

</script>
</body>
</html>

